## 问题

有n步台阶，一次只能最多走 k 步，共有多少种走法


## 分析

初步分析, 假设一次可以走1 ~ 4 阶，对于N阶，有

| N   | 走法                                                                                   | 合计  |
| --- | ------------------------------------------------------------------------------------ | --- |
| 0   | [0]                                                                                  | 0   |
| 1   | [1]                                                                                  | 1   |
| 2   | [1, 1] [2]                                                                           | 2   |
| 3   | [1, 1, 1] [2, 1]   [1,2],  [3]                                                       | 4   |
| 4   | [1, 1, 1,1]     [2, 1,1]   [1,2,1]  [3, 1]  [1, 1, 2] [2,2]  [1,3]  [4]              | 8   |
| 5   | [1, 1, 1,1,1]  [2, 1,1,1]   [1,2,1,1]  [3, 1,1]  [1, 1, 2,1] [2,2,1]  [1,3,1]  [4,1] | 8   |

使用动态规划的思想, 进一步分析：

> 如果 N <= K，那么第n阶的走法相当于：

+ 第n-1阶的走法 （剩1个台阶一步跨到底）

+ 第n-2阶的走法 （剩2个台阶一步跨到底，如果是（1，1）走法，就和n-1 的走法重复） 

+ 第n-3阶的走法 （剩3个台阶一步跨到底，先走1步或两步都会和前面的步骤重复）

+ ...

+ 再加上1种（一步跨越K阶）

   即总的走法是：
   $$
   \begin{aligned}
   a_n =& a_{n-1} + a_{n-2} + ... + a_1 + 1 \\
       =& S_{n-1} + 1
   \end{aligned}
   $$

证明得出 a<sub>n</sub> 是等比数列，公比为2，并且a<sub>1</sub>= 1
$$
\begin{aligned}
a_{n+1} =& S_n + 1 \\
 =& (S_{n-1} + a_n + 1) \\
 =& (a_n-1 + a_n + 1) \\
 =& 2a_n
\end{aligned}
$$

> 如果 n > k，那么第n步骤的走法相当于前面所有走法

$$
a_n = a_{n-k} + a_{n-2} + ... + a_{n-1}
$$



例如：

1. n=k+1，a<sub>n</sub> =a<sub>k</sub>(最后一步只能一步跨到底)
2. n=k+2，a<sub>n</sub> =a<sub>k</sub>（一次跨两步）+a<sub>k+1</sub>(一次跨一步)

## 算法实现

```python
def n_footstep_recursive(k, n):
    steps = [2**i for i in range(k)]
       @functools.lru_cache()
    def foo(n):
        if n <= k:
            return steps[n - 1]
        else:
            return sum([foo(i) for i in range(n - k, n)])
    return foo(n)
```

当n到一定值时，递归速度非常慢，使用`functools.lru_cache`装饰器可以加快程序执行速度

```python
def n_footstep(k, n):
    steps = [0]
    for i in range(k):
        steps.append(2 ** i)
    for i in range(k, n):
        steps.append(sum(steps[-k:]))
    return steps[n - 1]
```

| 假设 n =20, k = [0,1,2,3…,9],结果如下                        | 假设 k = 4， n=[0,1,2, … ,20],结果如下:                      |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| <img src="https://gitee.com/fjboy/cdn/raw/image-bed/2021/12/17/image-20211217004445583.png" alt="image-20211217004445583" style="zoom: 67%;" /> | <img src="https://gitee.com/fjboy/cdn/raw/image-bed/2021/12/17/image-20211125231210784.png" alt="image-20211125231210784" style="zoom:80%;" /> |

